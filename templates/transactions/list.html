{% extends 'base.html' %}

{% block title %}Transaction List - Toll Report System{% endblock %}

{% block menu_toggle %}{% endblock %}

{% block floating_nav %}
{% include 'floating_nav.html' %}
{% endblock %}

{% block content %}
<div class="col-md-5" align="right">
    <a href="{% url 'transactions:transaction_pdf' %}" class="btn btn-danger">Convert into PDF</a>
</div>

<h1>Transaction Details</h1>

<div class="table-responsive">
    <table class="table">
        <thead>
            <tr>
                <th>S/N</th>
                <th>Trans No.</th>
                <th>Date</th>
                <th>Collector ID</th>
                <th>Lane No.</th>
                <th>Vehicle Type</th>
                <th>Registration No.</th>
                <th>Fare</th>
                <th>Image</th>
            </tr>
        </thead>
        <tbody>
            {% for tran in data %}
            <tr>
                <td>{{ tran.plazaid }}</td>
                <td>{{ tran.sequence }}</td>
                <td>{{ tran.capturedate|date:"Y-m-d H:i:s" }}</td>
                <td>{{ tran.collectorid }}</td>
                <td>{{ tran.lane }}</td>
                <td>{{ tran.vehicle_class }}</td>
                <td>{{ tran.regnumber }}</td>
                <td>{{ tran.get_formatted_fare }}</td>
                <td>
                    {% if tran.pic %}
                        <img src="data:image/jpg;base64,{{ tran.pic|default:'' }}" 
                             width="100px" alt="Image not Available" 
                             onerror="this.alt='No Image'; this.style.display='none';" />
                    {% else %}
                        No Image
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9" class="text-center">No transactions found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="d-flex justify-content-center">
    {% if data.has_other_pages %}
        <div class="pagination">
            {% if data.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ data.previous_page_number }}">previous</a>
            {% endif %}
            
            <span class="current">
                Page {{ data.number }} of {{ data.paginator.num_pages }}
            </span>
            
            {% if data.has_next %}
                <a href="?page={{ data.next_page_number }}">next</a>
                <a href="?page={{ data.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %} 